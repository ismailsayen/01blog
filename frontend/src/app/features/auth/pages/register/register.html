<div class="form-child w-100 vh-100 g-10 d-flex justify-content-center align-items-center flex-column">
  <app-header-form [page]="'register'" />


  <form class="w-75 p-1" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
    <div class="mb-3">
      <label for="userName" class="form-label fw-bold">userName:</label>
      <input type="text" id="userName" class="form-control" formControlName="userName" placeholder="User Name">
      @if (userName?.invalid && (userName?.dirty || userName?.touched)) {
      @if (userName?.hasError("backend")) {
      <div class="text-danger">{{userName?.errors?.['backend'] }}</div>
      }
      @if (userName?.hasError("required")) {
      <div class="text-danger">User name is required.</div>
      }
      @if (userName?.hasError("minlength")) {
      <div class="text-danger">User name must be at least 4 characters.</div>
      }
      @if (userName?.hasError("maxlength")) {
      <div class="text-danger">User name must be at most 20 characters.</div>
      }
      }
    </div>
    <div class="mb-3">
      <label for="email" class="form-label fw-bold">Email address:</label>
      <input type="email" id="email" class="form-control" formControlName="email" placeholder="Email">
      @if (email?.invalid && (email?.dirty || email?.touched)) {
      @if (email?.hasError("backend")) {
      <div class="text-danger">{{email?.errors?.['backend'] }}</div>
      }
      @if (email?.hasError("required")) {
      <div class="text-danger">Email is required.</div>
      }

      @if (email?.hasError("email")) {
      <div class="text-danger">Email format is invalid.</div>
      }
      }
      @if(backendError()){
      <div class="text-danger">{{backendError()}}</div>
      }
    </div>

    <app-jobs-select [control]="job" />

    <div class="mb-3 position-relative">
      <label for="password" class="form-label fw-bold">Password:</label>
      <div class="d-flex align-items-center">
        <input [type]="auth.showPassword()?'text':'password'" id="password" class="form-control"
          formControlName="password" placeholder="Password">
        <i class="position-absolute pass" [ngClass]="auth.showPassword() ? 'bi-eye-fill' : 'bi-eye-slash-fill'"
          role="button" (click)="auth.show()">
        </i>
      </div>

      @if(password?.dirty || password?.touched){
      <div
        [ngClass]="(password?.hasError('lengthError') || password?.hasError('required'))?'text-danger':'text-success'">
        <i
          [ngClass]="(password?.hasError('lengthError')|| password?.hasError('required'))?'bi bi-x-circle-fill text-danger':'bi bi-check-circle-fill text-success'"></i>
        Password must be between 8 and 16 characters.
      </div>
      <div [ngClass]="(password?.hasError('pattern')|| password?.hasError('required'))?'text-danger':'text-success'">
        <i
          [ngClass]="(password?.hasError('pattern')|| password?.hasError('required'))?'bi bi-x-circle-fill text-danger':'bi bi-check-circle-fill text-success'"></i>
        Password must contain one special character, one uppercase letter, one lowercase letter, and one number.
      </div>
      }
    </div>
    <div class="mb-3 media gap-3">
      <div >
        <label for="avatar" class="form-label fw-bold">Avatar:<span class="text-muted fw-light">(Optional)</span>
        </label>
        <input type="file" id="avatar" class="form-control" accept="image/*" (change)="onUploadMedia($event)">
      </div>
      <div class="mb-3 justify-content-center t p-2">
        @if (!previewUrl()) {
        <label for="avatar" class="form-label fw-bold">
          <i class="bi bi-upload upload-icon"></i>
        </label>
        }@else {
        <div class="position-relative media-prev ">
          <i class="bi bi-trash3-fill delete-icon" role="button" (click)="removePerview()"></i>
          <img [src]="previewUrl()?.previewUrl" alt="" width="100" height="100" class="rounded-circle">
        </div>
        }
        @if (avatar.invalid && (avatar.dirty || avatar.touched)) {
        @if (avatar.hasError("invalidMedia")) {
        <div class="text-danger">Image Error</div>
        }
        }
      </div>
    </div>
    <div class="mb-3">
      <app-button-submit [value]="'register'" />
    </div>
  </form>
</div>
